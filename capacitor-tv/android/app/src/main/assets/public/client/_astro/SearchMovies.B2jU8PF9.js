import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.Be8AcK8B.js";const L=c=>{let s=c||"https://api.tramphim.com";return s&&!s.includes("localhost")&&s.startsWith("http://")&&(s=s.replace("http://","https://")),s};function R({initialSearchMovies:c=[],searchKeyword:s="",initialData:x,baseUrl:P,initialLimit:g,tittle:k}){const h=L(P),a=!!s,[d,m]=i.useState(a?c:x?.data||[]),[b,w]=i.useState(a?{current_page:1,total_pages:1}:x?.pagination||{current_page:1,total_pages:1}),[n,y]=i.useState(!1),[o,N]=i.useState(null);i.useEffect(()=>{m(a?c:x?.data||[]),w(a?{current_page:1,total_pages:1}:x?.pagination||{current_page:1,total_pages:1})},[c,s,x,a]);const r=b.current_page,p=b.total_pages,C=i.useCallback(async(e=1)=>{y(!0),N(null);try{let l;a&&s?l=`${h}/api/search/?q=${encodeURIComponent(s)}&page=${e}&limit=${g}`:l=`${h}/api/phim/?page=${e}&limit=${g}&sort=luot-xem`;const f=await fetch(l);if(!f.ok)throw new Error(`Lỗi khi fetch API: ${l} - Status: ${f.status}`);const $=await f.json();m($.data||[]),w($.pagination||{current_page:1,total_pages:1});const j=new URL(window.location.pathname,window.location.origin);a&&s&&j.searchParams.set("q",encodeURIComponent(s)),j.searchParams.set("page",e.toString()),window.history.pushState(null,"",j.toString())}catch{N("Không thể tải phim. Vui lòng thử lại."),m([])}finally{y(!1)}},[h,g,a,s]),u=e=>{C(e)},_=[],v=Math.max(1,r-2),U=Math.min(p,v+4);for(let e=v;e<=U;e++)_.push(e);const S=a?`Kết Quả Với Từ Khóa: "${s}"`:k||"Tuyển Tập Phim";return t.jsxs("div",{children:[t.jsx("div",{className:"",children:t.jsx("div",{className:"flex flex-row items-center justify-between gap-8 lg:justify-start",children:t.jsx("h1",{className:"mb-4 text-lg font-semibold lg:text-xl",children:S})})}),o&&t.jsx("div",{className:"mt-8 text-center text-red-500",children:o}),n&&t.jsx("div",{className:"mt-8 text-center text-gray-400",children:"Đang tải phim..."}),!n&&!o&&d.length===0&&t.jsx("div",{className:"mt-8 text-center text-gray-400",children:"Không tìm thấy phim nào phù hợp."}),!n&&!o&&d.length>0&&t.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-1",children:d.map(e=>t.jsx("a",{href:`/phim/${e.slug}`,className:"group flex flex-row gap-2 lg:gap-8",children:t.jsx("div",{children:t.jsxs("div",{className:"group flex flex-row gap-2 lg:gap-8",children:[t.jsx("div",{className:"relative h-36 w-24 overflow-hidden rounded-[4px] lg:h-56 lg:w-40",children:t.jsx("img",{src:e.poster_url,alt:e.title||e.ten_phim,className:"h-full w-full rounded-[4px] object-cover",fetchPriority:"high"})}),t.jsxs("div",{className:"flex flex-1 flex-col justify-between px-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"line-clamp-2 text-sm font-semibold text-white hover:text-sky-300 lg:text-xl",title:e.ten_phim,children:e.ten_phim}),t.jsx("p",{className:"mt-1 line-clamp-1 text-xs font-medium text-gray-400 lg:text-base",children:e.ten_khac}),t.jsxs("p",{className:"text-gray-20 mt-1 line-clamp-1 text-xs font-medium lg:text-sm",children:[t.jsx("span",{className:"text-[#a9a9ac]",children:"Năm: "}),e.nam_phat_hanh]}),t.jsxs("p",{className:"text-gray-20 mt-1 line-clamp-1 text-xs font-medium lg:text-sm",children:[t.jsx("span",{className:"text-[#a9a9ac]",children:"Tình Trạng: "}),e.tinh_trang]}),t.jsxs("p",{className:"text-gray-20 mt-1 line-clamp-1 text-xs font-medium lg:text-sm",children:[t.jsx("span",{className:"text-[#a9a9ac]",children:"Chất Lượng: "}),e.chat_luong]}),e.dien_vien&&e.dien_vien.length>0&&t.jsxs("h2",{className:"my-1 hidden text-[13px] font-medium text-[#a9a9ac] md:block lg:text-sm",children:["Diễn viên:",t.jsx("span",{className:"my-1 line-clamp-2 text-white",children:e.dien_vien.map(l=>l.ten).join(", ")})]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("div",{className:"inline-flex items-center rounded-full bg-sky-400 px-2 py-1 text-xs font-medium text-white transition-colors duration-300 lg:px-3 lg:py-2 lg:text-sm",children:"Xem Ngay"})})]})]})})},e.id))}),p>1&&t.jsxs("nav",{className:"mt-8 flex flex-wrap items-center justify-center gap-2",children:[r>1&&t.jsx("button",{onClick:()=>u(r-1),className:"flex h-8 w-8 items-center justify-center rounded-[4px] border border-gray-600 bg-[#23252b] text-sm text-gray-300 hover:bg-gray-600","aria-label":"Trang trước",disabled:n,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",children:t.jsx("path",{fill:"currentColor",d:"m2 10l8 8l1.4-1.4L5.8 11H18V9H5.8l5.6-5.6L10 2z"})})}),_.map(e=>t.jsx("button",{onClick:()=>u(e),className:`flex h-8 w-8 items-center justify-center rounded-[4px] border text-sm ${r===e?"border-orange-400 bg-orange-500 text-white":"border-gray-600 bg-[#23252b] text-gray-300 hover:bg-gray-600"}`,disabled:n,children:e},e)),r<p&&t.jsx("button",{onClick:()=>u(r+1),className:"flex h-8 w-8 items-center justify-center rounded-[4px] border border-gray-600 bg-[#23252b] text-sm text-gray-300 hover:bg-gray-600","aria-label":"Trang sau",disabled:n,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",children:t.jsx("path",{fill:"currentColor",d:"M8.6 3.4L14.2 9H2v2h12.2l-5.6 5.6L10 18l8-8l-8-8z"})})})]})]})}export{R as default};
