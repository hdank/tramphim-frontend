import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.Be8AcK8B.js";import{l as X}from"./logo.YGYcGbSh.js";import{u as oe,A as ge}from"./AuthProvider.DtbN1DVM.js";import{H as we}from"./WatchedMoviesDropdown.CJi1npJU.js";import{B as be}from"./FavoriteMoviesDropdown.Ba_V6Rtf.js";import{y as z}from"./index.ujdCixWl.js";import{m as P}from"./proxy.jt7NOk77.js";const ae=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:e.jsx("path",{fillRule:"evenodd",d:"M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z",clipRule:"evenodd"})});function ve(){const{user:t,logout:s}=oe(),[i,a]=r.useState(!1),n=r.useRef(null),l=e=>!(!e||!e.premium_until)&&new Date(e.premium_until)>new Date;r.useEffect((()=>{console.log("[UserProfileDropdown] User updated:",t)}),[t]),r.useEffect((()=>{const e=e=>{n.current&&!n.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);return e.jsxs("div",{className:"relative",ref:n,children:[e.jsx("button",{onClick:()=>a(!i),className:"flex items-center justify-center w-10 h-10 text-white/80 hover:text-white focus:outline-none rounded-md","aria-label":"User menu",children:t&&t.anh_dai_dien_url?e.jsxs("div",{className:"relative h-8 w-8 flex items-center justify-center",children:[l(t)&&e.jsx("div",{className:"absolute -inset-[3px] rounded-full",style:{background:"conic-gradient(from 0deg, #ff0000, #ffffff, #000000, #ff0000)",animation:"spin 4s linear infinite",zIndex:0}}),e.jsx("img",{src:t.anh_dai_dien_url,alt:t.username,className:"relative h-full w-full rounded-full object-cover z-10 "+(l(t)?"border-2 border-[#1a1c22]":"ring-2 ring-white/10")})]}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-white/10 flex items-center justify-center ring-2 ring-white/10",children:e.jsx(ae,{})})}),i&&e.jsxs("div",{className:"fixed top-16 left-1/2 z-[60] mt-2 w-[90vw] max-w-sm -translate-x-1/2 origin-top divide-y divide-gray-100/10 rounded-xl bg-[#23252b]/95 backdrop-blur-xl border border-white/10 shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none sm:absolute sm:left-auto sm:right-0 sm:top-full sm:mt-2 sm:w-64 sm:translate-x-0 sm:origin-top-right",children:[e.jsx("div",{className:"px-4 py-3",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-white",children:["Xin chÃ o, ",t.username]}),e.jsx("div",{className:"flex items-center gap-1 mt-1 text-xs text-yellow-400",children:l(t)?e.jsx("span",{className:"font-bold bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-600 text-transparent bg-clip-text drop-shadow-sm tracking-wider",children:"PREMIUM"}):e.jsx("span",{})}),e.jsxs("p",{className:"text-xs text-gray-400",children:["ğŸª™ ",e.jsxs("b",{children:[t.points," Äáº­u"]}),e.jsx("a",{href:"/hoi-dap",className:"ml-2 text-gray-500 hover:text-gray-300 transition-colors inline-block",title:"Há»i - ÄÃ¡p vá» Äáº­u",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})})]})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"KhÃ¡ch"})}),e.jsxs("div",{className:"py-1",children:[t&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:"/tai-khoan",className:"group flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:[e.jsx(ae,{className:"mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-300","aria-hidden":"true"}),"ThÃ´ng tin tÃ i khoáº£n"]}),e.jsxs("a",{href:"/mini-game",className:"group flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:[e.jsx("div",{className:"mr-3 h-5 w-5 flex items-center justify-center text-purple-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})}),"ğŸ® Mini Games"]})]}),e.jsxs("a",{href:t?"/mua-dau":"/dang-nhap",className:"group flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:[e.jsx("div",{className:"mr-3 h-5 w-5 flex items-center justify-center text-yellow-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.04-1.34-.87-2.57-2.49-2.97V5h-2v.98c-1.53.37-2.98 1.46-2.98 3.12 0 1.77 1.02 2.29 2.64 2.72 1.88.45 2.42.97 2.42 1.81 0 .99-.72 1.55-2.05 1.55-1.42 0-2.28-.72-2.3-1.67h-1.74c.05 1.47 1.12 2.84 2.98 3.21v1.42h2v-1.41c1.63-.41 2.7-1.51 2.7-3.157 0-1.865-1.22-2.734-2.6-3.144z"})})}),"ğŸ’° Kiáº¿m Äáº­u"]}),e.jsxs("a",{href:t?"/doi-qua":"/dang-nhap",className:"group flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:[e.jsx("div",{className:"mr-3 h-5 w-5 flex items-center justify-center text-orange-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M9.375 3a1.875 1.875 0 000 3.75h1.875v4.5H3.375A1.875 1.875 0 011.5 9.375v-.75c0-1.036.84-1.875 1.875-1.875h3.193A3.375 3.375 0 0112 2.753a3.375 3.375 0 015.432 3.997h3.193c1.035 0 1.875.84 1.875 1.875v.75c0 1.036-.84 1.875-1.875 1.875H12.75v-4.5h1.875a1.875 1.875 0 10-1.875-1.875V6.75h-1.5V4.875C11.25 3.839 10.41 3 9.375 3zM11.25 12.75H3v6.75a2.25 2.25 0 002.25 2.25h6v-9zM12.75 12.75v9h6a2.25 2.25 0 002.25-2.25v-6.75h-8.25z"})})}),"ğŸ Äá»•i QuÃ "]}),e.jsxs("a",{href:t?"/mua-premium":"/dang-nhap",className:"group flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:[e.jsx("div",{className:"mr-3 h-5 w-5 flex items-center justify-center text-red-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})})}),"Mua tÃ i khoáº£n Youtube Premium - 40k/thÃ¡ng"]}),e.jsxs("a",{href:"/tai-khoan/yeu-thich",className:"group flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:[e.jsx("div",{className:"mr-3 h-5 w-5 flex items-center justify-center",children:e.jsx(be,{})}),"Phim YÃªu ThÃ­ch"]}),e.jsxs("a",{href:"/tai-khoan/lich-su",className:"group flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:[e.jsx("div",{className:"mr-3 h-5 w-5 flex items-center justify-center",children:e.jsx(we,{})}),"Lá»‹ch sá»­ xem"]})]}),e.jsx("div",{className:"py-1",children:t?e.jsx("button",{onClick:()=>{s(),a(!1)},className:"flex w-full items-center px-4 py-2 text-sm text-red-400 hover:bg-white/10 hover:text-red-300",children:"ÄÄƒng xuáº¥t"}):e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"/dang-nhap",className:"block px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:"ÄÄƒng nháº­p"}),e.jsx("a",{href:"/dang-ky",className:"block px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white",children:"ÄÄƒng kÃ½"})]})})]})]})}const ye="\n@keyframes spin {\n    from {\n        transform: rotate(0deg);\n    }\n    to {\n        transform: rotate(360deg);\n    }\n}\n";if(typeof document<"u"){const e=document.createElement("style");e.innerText=ye,document.head.appendChild(e)}const je=({hasUnread:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:t?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"})}),B="https://api.tramphim.com";function ke(){const{user:t}=oe(),[s,i]=r.useState(!1),[a,n]=r.useState([]),[l,o]=r.useState(0),[c,h]=r.useState(!1),d=r.useRef(null),m=async()=>{if(t){h(!0);try{const e=localStorage.getItem("access_token"),t=await fetch(`${B}/api/binhluan/user/notifications/`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const e=await t.json();n(e);const r=e.filter((e=>!e.da_xem)).length;o(r)}}catch(e){console.error("Error fetching notifications:",e)}finally{h(!1)}}};r.useEffect((()=>{if(!t)return;m();const e=setInterval(m,3e4);return()=>clearInterval(e)}),[t]),r.useEffect((()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const x=async e=>{if(e.da_xem||await(async e=>{try{const t=localStorage.getItem("access_token");(await fetch(`${B}/api/binhluan/${e}/mark-as-read/`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`}})).ok&&(n((t=>t.map((t=>t.id===e?{...t,da_xem:!0}:t)))),o((e=>Math.max(0,e-1))))}catch(e){console.error("Error marking notification as read:",e)}})(e.id),e.binh_luan_id)try{const t=localStorage.getItem("access_token"),r=await fetch(`${B}/api/binhluan/comment/${e.binh_luan_id}/phim-info/`,{headers:{Authorization:`Bearer ${t}`}});if(r.ok){const t=(await r.json()).slug,s=e.binh_luan_id;if(t&&s){const e=`/phim/${t}#binh_luan_${s}`,r=window.location.pathname,a=`/phim/${t}`;return i(!1),void(r===a?setTimeout((()=>{const e=document.getElementById(`binh_luan_${s}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("ring-2","ring-sky-400","bg-white/10"),setTimeout((()=>{e.classList.remove("ring-2","ring-sky-400","bg-white/10")}),3e3))}),100):window.location.href=e)}}else z.error("KhÃ´ng thá»ƒ táº£i thÃ´ng tin phim")}catch(e){console.error("Error fetching phim info:",e),z.error("Lá»—i khi táº£i thÃ´ng tin phim")}i(!1)};return e.jsxs("div",{className:"relative",ref:d,children:[e.jsxs("button",{onClick:()=>{i(!s),s||m()},className:"relative flex items-center justify-center w-10 h-10 text-white/80 hover:text-white focus:outline-none transition-colors rounded-md","aria-label":"Notifications",children:[e.jsx(je,{hasUnread:l>0}),l>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:l>9?"9+":l})]}),s&&e.jsxs("div",{className:"fixed top-16 left-1/2 z-[60] mt-2 max-h-[80vh] w-[90vw] max-w-md -translate-x-1/2 overflow-y-auto rounded-xl bg-[#23252b]/95 backdrop-blur-xl border border-white/10 shadow-2xl ring-1 ring-black ring-opacity-5 sm:absolute sm:left-auto sm:right-0 sm:top-full sm:mt-2 sm:w-96 sm:max-h-96 sm:translate-x-0",children:[e.jsx("div",{className:"sticky top-0 border-b border-gray-100/10 bg-[#23252b]/95 backdrop-blur-xl px-4 py-3 z-10",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:"ThÃ´ng bÃ¡o"})}),c?e.jsx("div",{className:"px-4 py-6 text-center text-gray-400",children:e.jsx("p",{className:"text-sm",children:"Äang táº£i..."})}):t?0===a.length?e.jsx("div",{className:"px-4 py-6 text-center",children:e.jsx("p",{className:"text-sm text-gray-400",children:"ChÆ°a cÃ³ thÃ´ng bÃ¡o nÃ o"})}):e.jsx("div",{className:"divide-y divide-gray-100/10",children:a.map((t=>e.jsxs("div",{className:"px-4 py-3 transition-colors group flex items-start gap-3 "+(t.da_xem?"hover:bg-white/5":"bg-white/10 hover:bg-white/15"),children:[e.jsxs("div",{onClick:()=>x(t),className:"flex-1 cursor-pointer flex gap-3 items-start min-w-0",children:["system"===t.loai?e.jsx("div",{className:"h-8 w-8 rounded-full bg-sky-600 flex-shrink-0 flex items-center justify-center ring-1 ring-white/10",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 text-white",children:[e.jsx("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 01-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004zM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 01-.921.42z"}),e.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v.816a3.836 3.836 0 00-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 01-.921-.421l-.879-.66a.75.75 0 00-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 001.5 0v-.81a4.124 4.124 0 001.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 00-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 00.933-1.175l-.415-.33a3.836 3.836 0 00-1.719-.755V6z",clipRule:"evenodd"})]})}):t.binh_luan?.nguoi_dung?.anh_dai_dien_url?e.jsx("img",{src:t.binh_luan.nguoi_dung.anh_dai_dien_url,alt:t.binh_luan.nguoi_dung.username,className:"h-8 w-8 rounded-full object-cover flex-shrink-0 ring-1 ring-white/10"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-white/10 flex-shrink-0 flex items-center justify-center ring-1 ring-white/10",children:e.jsx("span",{className:"text-xs font-semibold text-white",children:t.binh_luan?.nguoi_dung?.username?.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:["system"===t.loai?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-white font-medium",children:"Há»‡ thá»‘ng"}),e.jsx("p",{className:"text-xs text-gray-300 mt-1 whitespace-pre-line",children:t.noi_dung})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-white",children:[e.jsx("span",{className:"font-medium",children:t.binh_luan?.nguoi_dung?.username})," ","reply"===t.loai&&"Ä‘Ã£ tráº£ lá»i bÃ¬nh luáº­n cá»§a báº¡n"]}),t.binh_luan?.noi_dung&&e.jsxs("p",{className:"text-xs text-gray-400 line-clamp-2 mt-1",children:['"',t.binh_luan.noi_dung,'"']})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.ngay_tao).toLocaleDateString("vi-VN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),!t.da_xem&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-sky-400 flex-shrink-0 mt-2"})]}),e.jsx("button",{onClick:e=>(async(e,t)=>{e.stopPropagation();try{const e=localStorage.getItem("access_token");(await fetch(`${B}/api/binhluan/${t}/delete-notification/`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}})).ok?(n((e=>e.filter((e=>e.id!==t)))),o((e=>Math.max(0,e-1))),z.success("XÃ³a thÃ´ng bÃ¡o thÃ nh cÃ´ng")):z.error("Lá»—i khi xÃ³a thÃ´ng bÃ¡o")}catch(e){console.error("Error deleting notification:",e),z.error("Lá»—i khi xÃ³a thÃ´ng bÃ¡o")}})(e,t.id),className:"flex-shrink-0 text-gray-400 hover:text-red-400 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all p-1",title:"XÃ³a thÃ´ng bÃ¡o",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},t.id)))}):e.jsxs("div",{className:"px-4 py-6 text-center",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ xem thÃ´ng bÃ¡o"}),e.jsx("a",{href:"/dang-nhap",className:"mt-2 inline-block rounded-md bg-white/10 px-4 py-2 text-sm font-medium text-white hover:bg-white/20",children:"ÄÄƒng nháº­p"})]})]})]})}const Ne=()=>{let e="https://api.tramphim.com";return e&&!e.includes("localhost")&&e.startsWith("http://")&&(e=e.replace("http://","https://")),e},Y=Ne(),ne=()=>e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),Se=()=>e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),ie=({open:t})=>e.jsx("svg",{className:"h-4 w-4 transform transition-transform duration-300 "+(t?"":"-rotate-90"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),Ce=({open:t})=>e.jsxs("div",{className:"relative h-6 w-6",children:[e.jsx("svg",{className:`absolute left-0 top-0 h-6 w-6 transition-all duration-300 ease-in-out ${t?"scale-75 opacity-0":"scale-100 opacity-100"} `,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{fill:"none",stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h8m-8 6h16"})}),e.jsx("svg",{className:`absolute left-0 top-0 h-6 w-6 transition-all duration-300 ease-in-out ${t?"scale-100 opacity-100":"scale-75 opacity-0"} `,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12",className:"text-red-300"})})]});function De(){const[t,s]=r.useState([]),[i,a]=r.useState(!1),[n,l]=r.useState(!1),[o,c]=r.useState(!1),[h,d]=r.useState(!1),[m,x]=r.useState(!1),[u,p]=r.useState(!1),[g,f]=r.useState(""),[w,v]=r.useState(""),[b,j]=r.useState([]),[y,k]=r.useState(!1),[N,C]=r.useState(!1),[_,L]=r.useState(""),[z,M]=r.useState([]),[E,S]=r.useState(!1),[$,T]=r.useState(!1),B=r.useRef(null),R=r.useRef(null),A=r.useRef(null),D=r.useRef(null),I=r.useRef(null),H=r.useRef(null),U=r.useRef(null),F=r.useRef(null),V=r.useRef(null),W=r.useCallback((async()=>{try{const e=await fetch(`${Y}/api/theloai/`);if(!e.ok)throw new Error("Lá»—i khi fetch danh sÃ¡ch thá»ƒ loáº¡i");const t=await e.json();s(t)}catch(e){console.error("Fetch TheLoai List Error:",e),s([])}}),[]);r.useEffect((()=>{if(typeof window<"u"){const e=()=>c(window.scrollY>50);return window.addEventListener("scroll",e),f(window.location.pathname),W(),()=>window.removeEventListener("scroll",e)}}),[W]),r.useEffect((()=>{if(typeof document<"u"){const e=e=>{"Escape"===e.key&&q()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}}),[]),r.useEffect((()=>{if(typeof document<"u"){const e=e=>{B.current&&!B.current.contains(e.target)&&a(!1),R.current&&!R.current.contains(e.target)&&l(!1),A.current&&!A.current.contains(e.target)&&k(!1),h&&D.current&&!D.current.contains(e.target)&&U.current&&!U.current.contains(e.target)&&d(!1),F.current&&!F.current.contains(e.target)&&x(!1),V.current&&!V.current.contains(e.target)&&p(!1),I.current&&!I.current.contains(e.target)&&!e.target.closest(".mobile-search-results-dropdown")&&S(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}}),[h]),r.useEffect((()=>{if(w.trim().length<1)return j([]),void k(!1);C(!0),k(!0);const e=setTimeout((async()=>{try{const e=`${Y}/api/search/?q=${encodeURIComponent(w.trim())}`,t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json(),s=Array.isArray(r)?r:r&&r.data&&r.data.items?r.data.items:[];j(s),k(!0)}catch(e){console.error("Search error:",e),j([]),k(!0)}finally{C(!1)}}),150);return()=>{clearTimeout(e),C(!1)}}),[w]),r.useEffect((()=>{if(_.trim().length<1)return M([]),void S(!1);T(!0),S(!0);const e=setTimeout((async()=>{try{const e=await fetch(`${Y}/api/search/?q=${encodeURIComponent(_.trim())}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),r=Array.isArray(t)?t:t&&t.data&&t.data.items?t.data.items:[];M(r),S(!0)}catch(e){console.error("Lá»—i khi tÃ¬m kiáº¿m trÃªn mobile:",e),M([]),S(!0)}finally{T(!1)}}),150);return()=>{clearTimeout(e),T(!1)}}),[_]);const q=()=>{a(!1),l(!1),k(!1),S(!1),d(!1),v(""),L(""),x(!1),p(!1)},K=(e,t)=>{e.preventDefault(),typeof window<"u"&&(window.location.href=t),q()},Q=e=>{a(!i),l(!1),l(!1)},G=({results:t,isSearching:r,searchQueryLength:s,onResultClick:i,searchType:a})=>e.jsx("div",{className:"z-[9999] p-2",role:"listbox","aria-label":"Káº¿t quáº£ tÃ¬m kiáº¿m",children:r?e.jsx("div",{className:"p-4 text-center text-xs text-white/60",role:"status","aria-live":"polite",children:"Äang tÃ¬m kiáº¿m phim"}):t.length>0?e.jsxs(e.Fragment,{children:[t.slice(0,5).map((t=>e.jsxs("div",{onClick:e=>{e.preventDefault(),e.stopPropagation(),i(t)},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),i(t))},className:"flex cursor-pointer items-center space-x-3 rounded-md px-3 py-3 transition-all duration-200 focus:bg-white/10 focus:outline-none",role:"option",tabIndex:0,"aria-selected":!1,"aria-label":`Phim ${t.ten_phim}, ${t.tinh_trang}, ${t.ngon_ngu}`,children:[e.jsx("img",{src:t.poster_url,alt:"",className:"h-16 w-12 flex-shrink-0 rounded-[4px] object-fill",onError:e=>{e.target.src="/placeholder-image.jpg"},"aria-hidden":"true"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"truncate text-[13px] font-medium text-white hover:text-sky-300",children:t.ten_phim}),e.jsxs("p",{className:"truncate text-xs text-white/60",children:[t.tinh_trang," â€¢ ",t.ngon_ngu]})]})]},t.id))),t.length>5&&e.jsxs("a",{href:`/tim-kiem?q=${encodeURIComponent(("desktop"===a?w:_)||"").trim()}`,className:"block border-t border-white/10 px-3 py-2 text-center text-[13px] text-white hover:text-sky-300",onClick:e=>K(e,`/tim-kiem?q=${encodeURIComponent(("desktop"===a?w:_)||"").trim()}`),"aria-label":`Xem táº¥t cáº£ ${t.length} káº¿t quáº£ tÃ¬m kiáº¿m`,children:["Xem táº¥t cáº£ (",t.length," káº¿t quáº£)"]})]}):e.jsx("div",{className:"p-4 text-center text-white/60",role:"status","aria-live":"polite",children:"KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£."})});return e.jsxs(ge,{children:[E&&_.trim().length>=1||h?e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:q,onKeyDown:e=>{"Escape"===e.key&&q()},className:"fixed inset-0 z-40 bg-black/20 backdrop-blur-sm lg:hidden",role:"button",tabIndex:0,"aria-label":"ÄÃ³ng overlay"}):null,e.jsx("header",{ref:U,className:"header-wrapper-main z-50 mx-auto max-w-screen-2xl px-4 py-0 transition-all duration-500 ease-out lg:px-6 lg:py-2 2xl:px-4 "+(o?"header-scrolled":""),role:"banner",children:e.jsxs("div",{className:"md:h-18 relative flex h-16 w-full items-center justify-between",children:[e.jsxs("div",{className:"flex flex-grow items-center gap-4 sm:gap-16",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2 lg:gap-4",children:[e.jsx("button",{onClick:()=>d((e=>!e)),className:"flex text-white/80 hover:text-white focus:text-white xl:hidden","aria-label":h?"ÄÃ³ng menu":"Má»Ÿ menu","aria-expanded":h,"aria-controls":"mobile-menu",children:e.jsx(Ce,{open:h})}),e.jsx("div",{children:e.jsx("a",{href:"/",className:"flex-shrink-0 ","aria-label":"Trang chá»§",onClick:e=>K(e,"/"),children:e.jsx("img",{src:"string"==typeof X?X:X.src,alt:"Logo trang web phim",className:"h-12 w-auto sm:h-14 md:h-16 lg:h-20 xl:h-24"})})}),e.jsx("nav",{className:"hidden items-center text-xs lg:space-x-2 lg:text-sm xl:flex 2xl:space-x-6",role:"navigation","aria-label":"Menu chÃ­nh",children:e.jsxs("nav",{className:"ml-8 hidden items-center text-xs lg:space-x-6 lg:text-sm xl:flex 2xl:space-x-6",role:"navigation","aria-label":"Menu chÃ­nh",children:[[{href:"/loai-phim/phim-chieu-rap",label:"Phim Chiáº¿u Ráº¡p"},{href:"/loai-phim/phim-le",label:"Phim Láº»"},{href:"/loai-phim/phim-bo",label:"Phim Bá»™"},{href:"/loai-phim/hoat-hinh",label:"Hoáº¡t HÃ¬nh"},{href:"/anime",label:"Anime"}].map((t=>e.jsxs("a",{href:t.href,className:`font-mediumm relative py-2 text-[13px] transition-all duration-300 ${t.href,"text-white"} hover:text-sky-300`,onClick:e=>K(e,t.href),children:[t.label,e.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 w-full transform rounded-full bg-sky-300 transition-transform duration-300 "+(g===t.href?"scale-x-100":"scale-x-0"),"aria-hidden":"true"})]},t.href))),e.jsxs("div",{className:"relative hidden text-[13px] lg:block",ref:B,children:[e.jsxs("button",{onClick:()=>Q(),onKeyDown:e=>(e=>{("Enter"===e.key||" "===e.key||"ArrowDown"===e.key)&&(e.preventDefault(),Q())})(e),className:"flex items-center space-x-2 py-2 font-medium text-white","aria-expanded":i,"aria-haspopup":"true","aria-controls":"theloai-dropdown",id:"theloai-button",children:[e.jsx("span",{children:"Thá»ƒ Loáº¡i"}),e.jsx(ie,{open:i})]}),i&&t.length>0&&e.jsx("div",{className:"absolute left-2 top-full z-[51] mt-5 w-[30rem] overflow-hidden rounded-lg bg-[#23252b] shadow-2xl backdrop-blur-xl",role:"menu","aria-labelledby":"theloai-button",id:"theloai-dropdown",children:e.jsx("div",{className:"px-2 py-4",children:e.jsx("div",{className:"grid grid-cols-3 gap-1",children:t.map((t=>e.jsx("a",{href:`/the-loai/${t.slug}`,className:"block px-3 py-2 text-xs text-white hover:text-sky-300",onClick:e=>K(e,`/the-loai/${t.slug}`),role:"menuitem",children:t.ten},t.id)))})})})]})]})})]}),e.jsx("div",{className:"relative flex-grow lg:hidden",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),_.trim()&&(typeof window<"u"&&(window.location.href=`/tim-kiem?q=${encodeURIComponent(_)}`),S(!1),L(""),d(!1))},className:"relative flex-grow",role:"search",children:[e.jsx("label",{htmlFor:"mobile-search",className:"sr-only",children:"TÃ¬m kiáº¿m phim"}),e.jsx("input",{ref:I,id:"mobile-search",type:"text",value:_,onChange:e=>L(e.target.value),onFocus:()=>{(_.trim().length>=1||z.length>0)&&S(!0)},placeholder:"TÃ¬m kiáº¿m phim...",className:"h-8 w-full rounded-[4px] bg-white/10 px-4 pr-10 text-xs text-white placeholder-white/60 focus:outline-none",autoComplete:"off","aria-describedby":E?"mobile-search-results":void 0,"aria-expanded":E,"aria-autocomplete":"list",role:"combobox"}),_.length>0?e.jsx("button",{type:"button",onClick:()=>{L(""),S(!1)},className:"absolute right-0 top-0 h-full rounded-[4px] px-3 text-white/70 hover:text-white focus:outline-none","aria-label":"XÃ³a tÃ¬m kiáº¿m",children:e.jsx(Se,{})}):e.jsx("button",{type:"submit",className:"absolute right-2 top-0 h-full rounded-[4px] text-white/70 hover:text-white focus:outline-none","aria-label":"TÃ¬m kiáº¿m",children:e.jsx(ne,{})})]})})]}),e.jsxs("div",{className:"flex flex-shrink-0 items-center justify-center gap-2 px-0 md:gap-2 md:pl-2 lg:gap-3",children:[e.jsxs("div",{ref:A,className:"relative hidden lg:block",children:[e.jsxs("form",{onSubmit:e=>{e.preventDefault(),w.trim()&&(typeof window<"u"&&(window.location.href=`/tim-kiem?q=${encodeURIComponent(w)}`),k(!1))},className:"relative",role:"search",children:[e.jsx("label",{htmlFor:"desktop-search",className:"sr-only",children:"TÃ¬m kiáº¿m phim"}),e.jsx("input",{ref:H,id:"desktop-search",type:"text",value:w,onChange:e=>v(e.target.value),onFocus:()=>{(w.trim().length>=1||b.length>0)&&k(!0)},placeholder:"TÃ¬m kiáº¿m phim...",className:"w-[20rem] rounded-md bg-[#ffffff20] px-3 py-2.5 pr-12 text-sm text-white placeholder-white/60 focus:outline focus:outline-2 focus:outline-offset-[1px] focus:outline-[white]",autoComplete:"off","aria-describedby":y?"search-results":void 0,"aria-expanded":y,"aria-autocomplete":"list",role:"combobox"}),e.jsx("button",{type:"submit",className:"absolute right-3 top-1/2 flex h-6 -translate-y-1/2 items-center gap-2 border-l border-white/30 pl-3 text-white/70 transition-colors hover:text-white","aria-label":"TÃ¬m kiáº¿m",children:e.jsx(ne,{})})]}),y&&w.trim().length>=1&&e.jsx(P.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.2},className:"absolute right-0 top-full z-50 mt-2 max-h-[60vh] w-full overflow-y-auto rounded-xl bg-[#1a1c22]/95 shadow-2xl backdrop-blur-xl border border-white/10",id:"search-results",children:e.jsx(G,{results:b,isSearching:N,searchQueryLength:w.trim().length,onResultClick:e=>{v(""),k(!1),typeof window<"u"&&(window.location.href=`/phim/${e.slug}`)},searchType:"desktop"})})]}),e.jsxs("a",{href:"/tai-ung-dung",className:"hidden lg:flex items-center gap-1.5 rounded-lg bg-sky-500 px-3 py-1.5 text-xs font-medium text-white transition-all hover:bg-sky-600",title:"Táº£i á»©ng dá»¥ng Tráº¡mPhim",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]}),e.jsx("span",{children:"Táº£i App"})]}),e.jsx(ke,{}),e.jsx(ve,{})]})]})}),E&&_.trim().length>=1&&e.jsx(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mobile-search-results-dropdown absolute left-0 right-0 top-16 z-[51] max-h-[100vh] overflow-y-auto rounded-xl bg-[#0F111A]/95 shadow-2xl backdrop-blur-xl border border-white/10 lg:hidden",onClick:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),id:"mobile-search-results",children:e.jsx(G,{results:z,isSearching:$,searchQueryLength:_.trim().length,onResultClick:e=>{L(""),S(!1),typeof window<"u"&&(window.location.href=`/phim/${e.slug}`)},searchType:"mobile"})}),h&&e.jsx(P.div,{ref:D,initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,ease:"easeOut"},className:"absolute left-0 right-0 top-16 z-[51] w-full border-t border-white/10 bg-[#1a1a1a]/95 backdrop-blur-xl text-sm font-medium shadow-2xl lg:m-8 lg:w-[30%] xl:hidden",id:"mobile-menu",role:"navigation","aria-label":"Menu di Ä‘á»™ng",children:e.jsxs("div",{className:"px-3 py-3",children:[e.jsxs("a",{href:"/tai-ung-dung",className:"mb-3 flex items-center gap-3 rounded-xl bg-gradient-to-r from-sky-500 to-blue-600 px-4 py-3 text-white shadow-lg",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-white/20",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/80",children:"Táº£i á»©ng dá»¥ng"}),e.jsx("p",{className:"font-semibold",children:"Tráº¡mPhim"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:[{href:"/",label:"Trang Chá»§"},{href:"/loai-phim/phim-chieu-rap",label:"Phim Chiáº¿u Ráº¡p"},{href:"/lich-chieu",label:"Lá»‹ch Chiáº¿u"},{href:"/loai-phim/hoat-hinh",label:"Phim Hoáº¡t HÃ¬nh"},{href:"/anime",label:"Anime"},{href:"/loai-phim/phim-le",label:"Phim Láº»"},{href:"/loai-phim/phim-bo",label:"Phim Bá»™"}].map((t=>e.jsx("a",{href:t.href,className:"block rounded-md px-3 py-2 text-left text-xs transition-all hover:bg-white/10 hover:text-white focus:bg-none focus:text-white "+(g===t.href?"text-sky-300":"text-white/90"),onClick:e=>K(e,t.href),children:t.label},t.href)))}),e.jsxs("div",{className:"relative my-2",ref:F,children:[e.jsxs("button",{onClick:()=>(x(!m),void p(!1)),className:"flex w-full items-center justify-between rounded-md px-3 py-2 text-xs text-left transition-all focus:bg-none hover:text-white  "+(m?"text-sky-300":"text-white/90"),"aria-expanded":m,"aria-haspopup":"true",children:["Thá»ƒ Loáº¡i",e.jsx(ie,{open:m})]}),m&&t.length>0&&e.jsx("div",{className:"mt-1 grid grid-cols-3 gap-3 rounded-lg bg-white/5 px-3 py-2 text-white",children:t.map((t=>e.jsx("a",{href:`/the-loai/${t.slug}`,className:"block py-1 text-xs font-normal text-white transition-all hover:text-sky-300",onClick:e=>K(e,`/the-loai/${t.slug}`),children:t.ten},t.id)))})]})]})})]})}export{De as default};