const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/index.DOX-wRnW.js","_astro/index.QwYULZe3.js","_astro/jsx-runtime.D_zvdyIk.js","_astro/index.Be8AcK8B.js"])))=>i.map(i=>d[i]);
import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.Be8AcK8B.js";const C="modulepreload",S=function(t){return"/"+t},k={},E=function(f,d,x){let m=Promise.resolve();if(d&&d.length>0){let a=function(s){return Promise.all(s.map(o=>Promise.resolve(o).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),h=n?.nonce||n?.getAttribute("nonce");m=a(d.map(s=>{if(s=S(s),s in k)return;k[s]=!0;const o=s.endsWith(".css"),i=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${i}`))return;const r=document.createElement("link");if(r.rel=o?"stylesheet":C,o||(r.as="script"),r.crossOrigin="",r.href=s,h&&r.setAttribute("nonce",h),document.head.appendChild(r),o)return new Promise((v,c)=>{r.addEventListener("load",v),r.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})}))}function u(a){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=a,window.dispatchEvent(n),!n.defaultPrevented)throw a}return m.then(a=>{for(const n of a||[])n.status==="rejected"&&u(n.reason);return f().catch(u)})},A="https://api.tramphim.com";function T(){const[t,f]=l.useState(null),[d,x]=l.useState(!1),[m,u]=l.useState(!1),[a,n]=l.useState(!1),[h,s]=l.useState(!1);l.useEffect(()=>{o()},[]);const o=async()=>{try{const{Capacitor:c}=await E(async()=>{const{Capacitor:y}=await import("./index.QwYULZe3.js");return{Capacitor:y}},[]);if(!c.isNativePlatform())return;u(!0);const{App:g}=await E(async()=>{const{App:y}=await import("./index.DOX-wRnW.js");return{App:y}},__vite__mapDeps([0,1,2,3])),w=await g.getInfo(),p=parseInt(w.build,10);if(!p||isNaN(p))return;const _=i();n(_);const j=await fetch(`${A}/api/app-version/check/${_?"android_tv":"android_mobile"}/${p}`);if(!j.ok)return;const b=await j.json();(b.has_update||b.force_update)&&(f(b),x(!0))}catch{}},i=()=>{const c=navigator.userAgent.toLowerCase(),g=window.screen.width>=1280,w=!("ontouchstart"in window)&&navigator.maxTouchPoints===0;return["android tv","aftb","aftt","afts","shield"].some(N=>c.includes(N))||g&&w},r=()=>{t?.latest_version?.download_url&&window.open(t.latest_version.download_url,"_system")},v=()=>{if(!t?.force_update){x(!1),s(!0);try{localStorage.setItem(`update_dismissed_${t?.latest_version?.version_code}`,Date.now().toString())}catch{}}};return!m||!d||h?null:e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 p-4",children:e.jsxs("div",{className:"w-full max-w-md overflow-hidden rounded-2xl bg-[#1e2030] shadow-2xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-sky-500 to-blue-600 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-white/20",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:t?.force_update?"C·∫≠p Nh·∫≠t B·∫Øt Bu·ªôc":"C·∫≠p Nh·∫≠t M·ªõi"}),e.jsxs("p",{className:"text-sm text-white/80",children:["Phi√™n b·∫£n ",t?.latest_version?.version_name]})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"mb-4 text-gray-300",children:t?.message}),t?.latest_version?.release_notes&&e.jsxs("div",{className:"mb-4 max-h-40 overflow-y-auto rounded-lg bg-[#161824] p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold text-sky-400",children:"C√≥ g√¨ m·ªõi:"}),e.jsx("p",{className:"whitespace-pre-line text-sm text-gray-400",children:t.latest_version.release_notes})]}),t?.latest_version?.file_size&&e.jsxs("p",{className:"mb-4 text-sm text-gray-500",children:["üì¶ K√≠ch th∆∞·ªõc: ",t.latest_version.file_size]}),t?.force_update&&e.jsx("div",{className:"mb-4 rounded-lg bg-red-500/20 p-3",children:e.jsx("p",{className:"text-sm text-red-400",children:"‚ö†Ô∏è Phi√™n b·∫£n hi·ªán t·∫°i kh√¥ng c√≤n ƒë∆∞·ª£c h·ªó tr·ª£. Vui l√≤ng c·∫≠p nh·∫≠t ƒë·ªÉ ti·∫øp t·ª•c s·ª≠ d·ª•ng ·ª©ng d·ª•ng."})}),e.jsxs("div",{className:"flex gap-3",children:[!t?.force_update&&e.jsx("button",{onClick:v,className:"flex-1 rounded-lg border border-gray-600 px-4 py-3 text-gray-400 transition hover:bg-gray-700",children:"ƒê·ªÉ sau"}),e.jsx("button",{onClick:r,className:`flex-1 rounded-lg bg-gradient-to-r from-sky-500 to-blue-600 px-4 py-3 font-semibold text-white transition hover:from-sky-600 hover:to-blue-700 ${t?.force_update?"w-full":""}`,children:"C·∫≠p nh·∫≠t ngay"})]})]})]})})}export{T as U,E as _};
