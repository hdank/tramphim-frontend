import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.DtoOFyvK.js";import{y as m}from"./index.XlGkRt0C.js";import{r as D}from"./movieUtils.BPictt7M.js";import{a as z}from"./alarm.DxcPw94X.js";const N={src:"/_astro/qrtele.J0DJ4xmr.png",width:500,height:500,format:"png"},A="FavoriteDB",P=2,x="FavoriteDB",H=()=>new Promise(((e,t)=>{const s=indexedDB.open(A,2);s.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(x)||t.createObjectStore(x,{keyPath:"slug"})},s.onsuccess=t=>{e(t.target.result)},s.onerror=e=>{t("Error opening database: "+e.target.errorCode)}})),F=async e=>{try{const t=(await H()).transaction([x],"readwrite"),s=t.objectStore(x);if(!e||!e.slug)throw new Error("Movie object or slug is missing.");const l={slug:e.slug,ten_phim:e.ten_phim,ten_khac:e.ten_khac,banner_url:e.banner_url,poster_url:e.poster_url};return s.add(l),new Promise(((e,s)=>{t.oncomplete=()=>e(),t.onerror=()=>s(t.error)}))}catch(e){throw console.error("Error adding movie to favorites:",e),e}},V=async e=>{try{const t=(await H()).transaction([x],"readwrite").objectStore(x).delete(e);return new Promise(((e,s)=>{t.onsuccess=()=>e(),t.onerror=()=>s(t.error)}))}catch(e){throw console.error("Error removing movie from favorites:",e),e}},M=(e,t)=>{const s=`fav_${e}`,l=t?"1":"0",a=new Date;a.setDate(a.getDate()+30),document.cookie=`${s}=${l}; expires=${a.toUTCString()}; path=/; samesite=Lax`},S="https://api.motchillx.site",J=({movie:t,thongbao:s,firstEpisodeSlug:l,firstEpisodeType:a,initialIsFavorite:n})=>{const[r,i]=d.useState(!1),[o,c]=d.useState(t.luot_like||0),[x,h]=d.useState(t.luot_dislike||0),[g,f]=d.useState(!1),[p,u]=d.useState(!1),[w,j]=d.useState(n);d.useEffect((()=>{c(t.luot_like||0),h(t.luot_dislike||0)}),[t]);const v=()=>{document.execCommand("copy"),m.success("Đã sao chép liên kết!")},y=async()=>{if(!g)try{(await fetch(`${S}/api/phim/${t.slug}/like`,{method:"POST"})).ok?(c((e=>e+1)),p&&h((e=>e>0?e-1:0)),f(!0),u(!1)):console.error("Failed to like the movie")}catch(e){console.error("Error liking the movie:",e)}},k=async()=>{if(!p)try{(await fetch(`${S}/api/phim/${t.slug}/dislike`,{method:"POST"})).ok?(h((e=>e+1)),g&&c((e=>e>0?e-1:0)),u(!0),f(!1)):console.error("Failed to dislike the movie")}catch(e){console.error("Error disliking the movie:",e)}};return e.jsxs("div",{className:"flex w-full flex-col gap-6 lg:flex-row lg:justify-between",children:[e.jsxs("div",{className:"flex w-full flex-row items-start gap-8 lg:w-[70%] 2xl:w-[75%]",children:[e.jsx("div",{className:"w-[30%] flex-shrink-0 lg:h-full lg:w-[35%] 2xl:w-[27%]",children:e.jsxs("div",{className:"relative aspect-[2/3] rounded-lg lg:aspect-auto lg:h-full",children:[e.jsx("img",{src:t.poster_url,alt:`Poster phim ${t.ten_phim}`,className:"absolute left-0 top-0 h-full w-full rounded-lg object-cover",loading:"eager",fetchPriority:"high"}),e.jsx("div",{className:"pointer-events-none absolute bottom-0 left-0 h-[100%] w-full rounded-b-[6px]",style:{background:"linear-gradient(to top, rgba(30, 30, 30, 0.2), transparent)"},"aria-hidden":"true"})]})}),e.jsxs("div",{className:"flex w-full flex-1 flex-col items-start gap-3 lg:h-full lg:justify-between",children:[e.jsxs("div",{className:"flex w-full flex-col gap-1",children:[e.jsx("h1",{className:"text-left text-lg font-semibold leading-tight text-white lg:text-xl",children:t.ten_phim}),t.ten_khac&&e.jsx("p",{className:"text-left text-sm font-normal text-[#ffd875]",children:t.ten_khac}),e.jsxs("div",{className:"mt-2 flex w-full flex-wrap items-center justify-start gap-1 text-xs font-medium sm:flex lg:gap-6 lg:text-sm",children:[t.tinh_trang&&e.jsxs("div",{className:"text-left lg:flex-none",children:[e.jsx("span",{className:"hidden text-gray-300 lg:inline",children:"Tình Trạng:"}),e.jsx("span",{className:"ml-0 font-semibold text-sky-300 lg:ml-2",children:t.tinh_trang})]}),t.nam_phat_hanh&&e.jsxs("div",{className:"text-left before:pr-2 before:content-['/'] lg:flex-none lg:before:content-none",children:[e.jsx("span",{className:"hidden text-gray-300 lg:inline",children:"Năm:"}),e.jsxs("span",{className:"ml-0 text-[#ECECEC] lg:ml-2",children:[t.nam_phat_hanh," "]})]}),t.ngon_ngu&&e.jsxs("div",{className:"text-left before:pr-2 before:content-['/'] lg:flex-none lg:before:content-none",children:[e.jsx("span",{className:"hidden text-gray-300 lg:inline",children:"Ngôn ngữ:"}),e.jsx("span",{className:"ml-0 text-[#ECECEC] lg:ml-2",children:D(t.ngon_ngu)})]})]}),t.the_loai&&t.the_loai.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"mr-2 text-xs font-medium text-gray-300 lg:text-sm",children:"Thể loại:"}),e.jsx("div",{className:"inline-flex flex-wrap gap-1",children:t.the_loai.map(((s,l)=>e.jsxs("span",{className:"text-xs text-[#ECECEC] lg:text-sm",children:[s.ten,l<t.the_loai.length-1&&" / "]},s.ten)))})]}),t.dao_dien&&e.jsx("div",{className:"py-1",children:e.jsxs("h2",{className:"my-1 text-xs font-medium text-gray-300 lg:text-sm",children:["Đạo diễn:",e.jsx("span",{className:"ml-2 font-normal text-[#ECECEC]",children:t.dao_dien})]})}),t.dien_vien&&e.jsx("div",{className:"my-1 flex flex-col gap-1 text-xs font-medium text-gray-300 lg:text-sm",children:e.jsxs("span",{className:"line-clamp-1",children:["Diễn viên:",e.jsx("span",{className:"ml-2 font-normal text-[#ECECEC]",children:t.dien_vien.length>0?t.dien_vien.map((e=>e.ten)).join(", "):"Đang cập nhật"})]})}),t.thoi_luong&&e.jsx("div",{className:"py-1",children:e.jsxs("h2",{className:"text-xs font-medium text-gray-300 lg:text-sm",children:["Thời Lượng:",e.jsx("span",{className:"ml-2 font-normal text-[#ECECEC]",children:t.thoi_luong})]})}),t.mo_ta&&e.jsxs("div",{className:"hidden flex-row gap-2 py-1 text-xs sm:flex lg:text-sm",children:[e.jsx("h2",{className:"whitespace-nowrap font-medium text-gray-300 lg:text-sm",children:"Nội Dung:"}),e.jsx("span",{className:"line-clamp-2 font-normal text-[#ECECEC]",children:t.mo_ta})]})]}),e.jsxs("div",{className:"mt-4 flex w-full flex-col items-start gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-row items-center gap-4",children:[e.jsx("a",{href:`/xem-phim/${t.slug}/${l}/${a}`,className:"inline-block rounded-full bg-sky-400 px-6 py-2.5 text-center text-sm font-semibold text-white transition-all duration-300 ease-in-out hover:scale-105",children:"Xem Ngay"}),e.jsx("button",{onClick:async()=>{if(t&&t.slug)try{w?(await V(t.slug),j(!1),M(t.slug,!1),m.info(`Đã xóa "${t.ten_phim}" khỏi danh sách yêu thích!`)):(await F(t),j(!0),M(t.slug,!0),m.success(`Đã thêm "${t.ten_phim}" vào danh sách yêu thích!`))}catch(e){console.error("Favorite action failed:",e),m.error("Lỗi khi cập nhật danh sách yêu thích.")}else m.error("Không thể thêm/xóa phim. Thiếu thông tin phim.")},"aria-label":w?"Xóa khỏi danh sách yêu thích":"Thêm vào danh sách yêu thích",className:"inline-flex items-center gap-2 rounded-full border p-2.5 text-center text-sm font-semibold transition-all duration-300 ease-in-out hover:scale-105 "+(w?"border-sky-300 text-sky-300":"border-gray-400 text-gray-400 hover:border-white hover:text-white"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:w?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})})]}),e.jsxs("div",{className:"hidden flex-row items-center gap-4 sm:flex",children:[e.jsxs("div",{className:"relative",children:[e.jsx("svg",{onClick:()=>i(!r),xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",viewBox:"0 0 48 48",className:"cursor-pointer text-gray-300 transition-all duration-300 ease-in-out hover:scale-105",children:e.jsxs("g",{fill:"none",stroke:"#d1d5db",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"4",children:[e.jsx("path",{d:"M28 6H42V20"})," ",e.jsx("path",{d:"M42 29.4737V39C42 40.6569 40.6569 42 39 42H9C7.34315 42 6 40.6569 6 39V9C6 7.34315 7.34315 6 9 6L18 6"}),e.jsx("path",{d:"M25.7998 22.1999L41.0998 6.8999"})," "]})}),r&&e.jsxs("div",{className:"absolute right-0 top-full z-50 mt-2 w-[350px] rounded-lg bg-[#35373d] p-4 shadow-lg",onClick:e=>e.stopPropagation(),children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Chia Sẻ"}),e.jsxs("div",{className:"mt-2 flex flex-row items-center gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:window.location.href,className:"flex-1 rounded-md bg-[#ffffff18] px-2 py-1 text-xs text-gray-300 outline-none"}),e.jsxs("button",{onClick:v,className:"rounded-md bg-sky-400 px-3 py-1 text-xs font-semibold text-white",children:["Sao Chép"," "]})]})]})]}),t.luot_xem&&e.jsxs("div",{className:"flex flex-row py-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",className:"cursor-pointer text-gray-300 transition-all duration-300 ease-in-out hover:scale-105",children:e.jsx("path",{fill:"currentColor",d:"M6 8c0-2.21 1.79-4 4-4s4 1.79 4 4s-1.79 4-4 4s-4-1.79-4-4m3.14 11.75L8.85 19l.29-.75c.7-1.75 1.94-3.11 3.47-4.03c-.82-.14-1.69-.22-2.61-.22c-4.42 0-8 1.79-8 4v2h7.27c-.04-.09-.09-.17-.13-.25M17 18c-.56 0-1 .44-1 1s.44 1 1 1s1-.44 1-1s-.44-1-1-1m6 1c-.94 2.34-3.27 4-6 4s-5.06-1.66-6-4c.94-2.34 3.27-4 6-4s5.06 1.66 6 4m-3.5 0a2.5 2.5 0 0 0-5 0a2.5 2.5 0 0 0 5 0"})}),e.jsx("span",{className:"font-normal text-gray-300",children:t.luot_xem})]}),t.luot_like>=0&&e.jsxs("div",{className:"flex flex-row py-1",children:[e.jsx("svg",{onClick:y,xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",className:"cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 "+(g?"text-sky-300":"text-gray-300"),children:e.jsx("path",{fill:"currentColor",d:"M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2M4 10h2v9H4zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7z"})}),e.jsx("span",{className:"font-normal text-gray-300",children:o})]}),t.luot_dislike>=0&&e.jsxs("div",{className:"flex flex-row py-1",children:[e.jsx("svg",{onClick:k,xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",className:"rotate-180 cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 "+(p?"text-sky-300":"text-gray-300"),children:e.jsx("path",{fill:"currentColor",d:"M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2M4 10h2v9H4zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7z"})}),e.jsx("span",{className:"font-normal text-gray-300",children:x})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 sm:hidden",children:[e.jsxs("div",{className:"relative flex items-center justify-center gap-6",children:[e.jsxs("svg",{onClick:()=>i(!r),xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",viewBox:"0 0 48 48",className:"cursor-pointer text-gray-300 transition-all duration-300 ease-in-out hover:scale-105",children:[e.jsxs("g",{fill:"none",stroke:"#d1d5db",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"4",children:[e.jsx("path",{d:"M28 6H42V20"}),e.jsx("path",{d:"M42 29.4737V39C42 40.6569 40.6569 42 39 42H9C7.34315 42 6 40.6569 6 39V9C6 7.34315 7.34315 6 9 6L18 6"}),e.jsx("path",{d:"M25.7998 22.1999L41.0998 6.8999"})]})," "]}),r&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50",onClick:()=>i(!1),children:e.jsxs("div",{className:"fixed left-1/2 top-1/2 z-50 w-[350px] -translate-x-1/2 -translate-y-1/2 rounded-lg bg-[#1a1a1a] p-4 shadow-lg",onClick:e=>e.stopPropagation(),children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Chia Sẻ"}),e.jsxs("div",{className:"mt-2 flex flex-row items-center gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:window.location.href,className:"flex-1 rounded-md bg-[#ffffff18] px-2 py-1 text-xs text-gray-300 outline-none"}),e.jsx("button",{onClick:v,className:"rounded-md bg-sky-400 px-3 py-1 text-xs font-semibold text-white",children:"Sao Chép"})]})]})}),t.luot_xem&&e.jsxs("div",{className:"flex flex-row py-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",className:"cursor-pointer text-gray-300 transition-all duration-300 ease-in-out hover:scale-105",children:e.jsx("path",{fill:"currentColor",d:"M6 8c0-2.21 1.79-4 4-4s4 1.79 4 4s-1.79 4-4 4s-4-1.79-4-4m3.14 11.75L8.85 19l.29-.75c.7-1.75 1.94-3.11 3.47-4.03c-.82-.14-1.69-.22-2.61-.22c-4.42 0-8 1.79-8 4v2h7.27c-.04-.09-.09-.17-.13-.25M17 18c-.56 0-1 .44-1 1s.44 1 1 1s1-.44 1-1s-.44-1-1-1m6 1c-.94 2.34-3.27 4-6 4s-5.06-1.66-6-4c.94-2.34 3.27-4 6-4s5.06 1.66 6 4m-3.5 0a2.5 2.5 0 0 0-5 0a2.5 2.5 0 0 0 5 0"})}),e.jsx("span",{className:"font-normal text-gray-300",children:t.luot_xem})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6",children:[t.luot_like>=0&&e.jsxs("div",{className:"flex flex-row py-1",children:[e.jsx("svg",{onClick:y,xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",className:"cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 "+(g?"text-sky-300":"text-gray-300"),children:e.jsx("path",{fill:"currentColor",d:"M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2M4 10h2v9H4zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7z"})}),e.jsx("span",{className:"font-normal text-gray-300",children:o})]}),t.luot_dislike>=0&&e.jsxs("div",{className:"flex flex-row py-1",children:[e.jsx("svg",{onClick:k,xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",className:"rotate-180 cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 "+(p?"text-sky-300":"text-gray-300"),children:e.jsx("path",{fill:"currentColor",d:"M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2M4 10h2v9H4zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7z"})}),e.jsx("span",{className:"font-normal text-gray-300",children:x})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 rounded-lg bg-[#ffffff1a] p-4 lg:w-[25%]",children:[t.tmdb&&e.jsxs("div",{className:"flex h-fit w-full flex-shrink-0 items-center justify-between",children:[e.jsxs("div",{className:"flex items-end gap-1 text-white",children:[e.jsx("span",{className:"text-2xl font-bold",children:t.tmdb}),e.jsx("span",{className:"text-sm",children:"/10"})," "]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:"flex items-center gap-1",children:(t=>{const s=Math.floor(t/2),l=[];for(let t=0;t<s;t++)l.push(e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"h-3 w-3 text-yellow-400",children:e.jsx("path",{d:"M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.511 8.243-7.447-3.957-7.447 3.957 1.511-8.243-6.064-5.828 8.332-1.151z"})},t));const a=5-s;for(let t=0;t<a;t++)l.push(e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-2.5 w-2.5 text-gray-300",children:e.jsx("path",{d:"M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.511 8.243-7.447-3.957-7.447 3.957 1.511-8.243-6.064-5.828 8.332-1.151z"})},t+s));return l})(t.tmdb)}),e.jsx("span",{className:"text-sm text-gray-300",children:"Đánh Giá"})," "]})]}),e.jsxs("div",{children:[s&&e.jsxs("div",{className:"my-2 flex w-full flex-col items-start gap-4 text-sm text-white",children:[e.jsxs("div",{className:"flex flex-row items-center justify-center gap-2",children:[e.jsx("div",{children:e.jsx("img",{src:z.src,alt:"Thông Báo",className:"h-8 w-8 rounded-full bg-[#0005]"})}),e.jsx("span",{className:"font-semibold text-transparent text-white",children:"Thông Báo"})]}),e.jsx("span",{className:"text-sm leading-6",dangerouslySetInnerHTML:{__html:s.noidung}})]}),e.jsxs("div",{className:"mt-8 hidden flex-col items-center justify-center gap-2 sm:flex",children:[e.jsx("img",{src:N.src,alt:"Mã QR Telegram",className:"h-32 w-32 object-contain"}),e.jsx("h3",{className:"text-xs font-medium text-gray-300",children:"Tham gia group Telegram"})]})]})]})," "]})};export{J as default};