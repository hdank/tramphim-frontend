import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DtoOFyvK.js";import{r as Y,a as D}from"./movieUtils.BPictt7M.js";const X=["phim-le","phim-bo","hoat-hinh"];function Z({initialData:t,initialSlug:a,baseUrl:l,initialLimit:s,tittle:n}){const[r,o]=i.useState(t?.data||[]),[h,c]=i.useState(t?.pagination||{current_page:1,total_pages:1}),[d,u]=i.useState(!1),[x,p]=i.useState(null),[m,g]=i.useState(h.current_page.toString()),[b,f]=i.useState(!1),v=i.useCallback(((e,t)=>{const a={the_loai:e?.filters?.the_loai||"",ngon_ngu:e?.filters?.ngon_ngu||"",nam_phat_hanh:e?.filters?.nam_phat_hanh||"",sort:e?.filters?.sort||"ngay-tao",chieu_rap:e?.filters?.chieu_rap||"",loai_phim:e?.filters?.loai_phim||""};return X.includes(t)?(a.loai_phim=t,a.chieu_rap=""):"phim-chieu-rap"===t?(a.chieu_rap="true",a.loai_phim=""):t&&(a.the_loai=t,a.loai_phim="",a.chieu_rap=""),a}),[]),[y,j]=i.useState((()=>v(t,a)));i.useEffect((()=>{j(v(t,a))}),[a,t,v]);const w=h.current_page,N=h.total_pages,k=[{label:"Tất cả",value:""},...Array.from({length:(new Date).getFullYear()-2e3+1},((e,t)=>({label:""+((new Date).getFullYear()-t),value:""+((new Date).getFullYear()-t)}))).sort(((e,t)=>parseInt(t.value)-parseInt(e.value)))],_=i.useCallback(((e=1)=>{const t=new URL(`${l}/api/filter/`);return t.searchParams.set("page",e.toString()),t.searchParams.set("limit",s.toString()),Object.entries(y).forEach((([e,a])=>{a&&t.searchParams.set(e,a)})),t.toString()}),[y,l,s]),T=i.useCallback((async(e=1)=>{u(!0),p(null);try{const t=_(e),a=await fetch(t);if(!a.ok)throw new Error(`Lỗi khi fetch API: ${t} - Status: ${a.status}`);const i=await a.json();o(i.data||[]),c(i.pagination||{current_page:1,total_pages:1}),g(i.pagination?.current_page.toString()||"1");const l=new URL(window.location.pathname,window.location.origin);l.searchParams.forEach(((e,t)=>{l.searchParams.delete(t)})),Object.entries(y).forEach((([e,t])=>{t&&l.searchParams.set(e,t)})),e>1?l.searchParams.set("page",e.toString()):l.searchParams.delete("page"),window.history.pushState(null,"",l.toString())}catch{p("Không thể tải phim. Vui lòng thử lại."),o([])}finally{u(!1)}}),[_,y]),L=e=>{T(e)},C=({title:t,options:i,filterKey:l})=>e.jsxs("div",{className:"flex flex-col gap-2 md:grid md:grid-cols-[100px_1fr] md:gap-4 md:border-b md:border-dotted md:border-gray-800 md:pb-4 md:last:border-b-0",children:[e.jsxs("p",{className:"whitespace-nowrap font-semibold text-gray-200 lg:text-sm",children:[t,":"]}),e.jsx("div",{className:"hide-scrollbar flex flex-row items-center gap-1 overflow-x-auto md:flex-wrap md:overflow-visible lg:gap-4",children:i.map((t=>e.jsx("button",{onClick:()=>((e,t)=>{j((a=>({...a,[e]:t})))})(l,t.value),className:`whitespace-nowrap rounded-[4px] px-3 py-1.5 transition-colors duration-200 ${y[l]===t.value?"bg-[#2f2f2f] text-sky-300":"text-gray-200 hover:text-white"} ${"chieu_rap"===l&&"phim-chieu-rap"===a&&""!==t.value?"cursor-not-allowed opacity-70":""}`,disabled:"chieu_rap"===l&&"phim-chieu-rap"===a&&""!==t.value,children:t.label},t.value)))})]});return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"mb-4 flex justify-start ",children:e.jsxs("button",{onClick:()=>{f((e=>!e))},className:"flex items-center gap-2 rounded-full bg-sky-500/80 px-4 py-2 text-sm font-semibold text-white transition-all duration-300 hover:bg-sky-500","aria-expanded":b,"aria-controls":"filter-panel",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 3.5H2l8 10.5V20l4 2v-8.5l8-10.5z"})}),e.jsx("h2",{children:"Bộ Lọc"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 transform transition-transform duration-300 "+(b?"rotate-180":""),viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),e.jsx("div",{id:"filter-panel",className:"flex flex-col gap-4 transition-all duration-500 ease-in-out "+(b?"max-h-screen opacity-100":"max-h-0 opacity-0 overflow-hidden"),children:e.jsxs("div",{className:"flex flex-col gap-4 rounded-lg border border-gray-200/20 p-4 text-xs text-white",children:[e.jsx(C,{title:"Loại phim",options:[{label:"Tất cả",value:""},{label:"Phim Lẻ",value:"phim-le"},{label:"Phim Bộ",value:"phim-bo"},{label:"Hoạt Hình",value:"hoat-hinh"}],filterKey:"loai_phim"}),e.jsx(C,{title:"Thể loại",options:[{label:"Tất cả",value:""},{label:"Hành Động",value:"hanh-dong"},{label:"Cổ Trang",value:"co-trang"},{label:"Viễn Tưởng",value:"vien-tuong"},{label:"Bí Ẩn",value:"bi-an"},{label:"Tâm Lý",value:"tam-ly"},{label:"Âm Nhạc",value:"am-nhac"},{label:"Phiêu Lưu",value:"phieu-luu"},{label:"Chính Kịch",value:"chinh-kich"},{label:"Khoa Học",value:"khoa-hoc"},{label:"Học Đường",value:"hoc-duong"},{label:"Võ Thuật",value:"vo-thuat"},{label:"Chiến Tranh",value:"chien-tranh"},{label:"Hình Sự",value:"hinh-su"},{label:"Gia Đình",value:"gia-dinh"},{label:"Tình Cảm",value:"tinh-cam"},{label:"Thần Thoại",value:"than-thoai"},{label:"Thể Thao",value:"the-thao"},{label:"Kinh Dị",value:"kinh-di"},{label:"Kinh Điển",value:"kinh-dien"}],filterKey:"the_loai"}),e.jsx(C,{title:"Hình thức",options:[{label:"Tất cả",value:""},{label:"Chiếu Rạp",value:"true"}],filterKey:"chieu_rap"}),e.jsx(C,{title:"Năm sản xuất",options:k,filterKey:"nam_phat_hanh"}),e.jsx(C,{title:"Ngôn ngữ",options:[{label:"Tất cả",value:""},{label:"Phụ Đề",value:"Vietsub"},{label:"Thuyết Minh",value:"Thuyết Minh"},{label:"P.Đề+ T.Minh",value:"Vietsub + Thuyết Minh"},{label:"Lồng Tiếng",value:"Lồng Tiếng"},{label:"Phụ Đề + Lồng Tiếng ",value:"Vietsub + Lồng Tiếng"},{label:"L.Tiếng + P.Đề + T.Minh",value:"Vietsub + Thuyết Minh + Lồng Tiếng"}],filterKey:"ngon_ngu"}),e.jsx(C,{title:"Sắp xếp",options:[{label:"Mới nhất",value:"ngay-tao"},{label:"Lượt xem",value:"luot-xem"},{label:"Tập mới nhất",value:"moi-cap-nhat"}],filterKey:"sort"}),e.jsxs("div",{className:"mt-4 flex justify-start gap-2",children:[e.jsx("button",{onClick:()=>{T(1)},className:"rounded-full bg-sky-300 px-4 py-2 text-xs font-semibold text-black transition-all duration-300 hover:scale-105",children:"Tìm Kiếm"}),e.jsx("button",{onClick:()=>{j(v(null,a)),T(1)},className:"rounded-full bg-gray-600 px-4 py-2 text-xs font-semibold text-white transition-all duration-300 hover:scale-105",children:"Xóa Bộ Lọc"})]})]})}),e.jsxs("div",{className:"mt-6 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-3",children:[e.jsx("div",{className:"h-1 w-8 rounded-full bg-gradient-to-r from-sky-400 to-cyan-300"}),e.jsx("h1",{className:"bg-gradient-to-r from-white via-sky-100 to-cyan-100 bg-clip-text text-lg font-bold text-transparent lg:text-2xl",children:n})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-sky-500/50 via-cyan-500/30 to-transparent"})]}),e.jsx("div",{className:"flex flex-row items-center justify-between gap-4",children:N>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:["Trang ",w," / ",N]}),e.jsx("button",{onClick:()=>L(w-1),className:"flex h-6 w-6 items-center justify-center rounded-[4px] bg-[#2f3346] text-sm text-gray-300 hover:bg-[#2f3346]/80 disabled:opacity-50","aria-label":"Trang trước",disabled:d||1===w,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M12.949 16.051a.999.999 0 0 1-1.414 0L5.586 10.586a1 1 0 0 1 0-1.414L11.535 3.949a.999.999 0 0 1 1.414 1.414L7.414 10l5.535 5.535a.999.999 0 0 1 0 1.414z"})})}),e.jsx("button",{onClick:()=>L(w+1),className:"flex h-6 w-6 items-center justify-center rounded-[4px] bg-[#2f3346] text-sm text-gray-300 hover:bg-[#2f3346]/80 disabled:opacity-50","aria-label":"Trang sau",disabled:d||w===N,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M7.051 3.949a.999.999 0 0 1 1.414 0L14.414 9.414a1 1 0 0 1 0 1.414l-5.949 5.949a.999.999 0 0 1-1.414-1.414L12.586 10 7.051 4.465a.999.999 0 0 1 0-1.414z"})})})]})})]}),x&&e.jsx("div",{className:"mt-8 text-center text-red-500",children:x}),!d&&!x&&0===r.length&&e.jsx("div",{className:"py-20 text-center text-gray-400",children:"Không tìm thấy phim nào phù hợp."}),d&&e.jsx("div",{className:"relative py-4",children:e.jsx("div",{className:"loading-container flex h-[20rem] w-full items-center justify-center",children:e.jsxs("svg",{width:"60",height:"30",viewBox:"0 0 100 50",children:[e.jsxs("line",{x1:"10",y1:"25",x2:"10",y2:"25",stroke:"#60A5FA",strokeWidth:"4",strokeLinecap:"round",children:[e.jsx("animate",{attributeName:"y1",values:"25;10;25",dur:"1s",begin:"0s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"y2",values:"25;40;25",dur:"1s",begin:"0s",repeatCount:"indefinite"})]}),e.jsxs("line",{x1:"30",y1:"25",x2:"30",y2:"25",stroke:"#60A5FA",strokeWidth:"4",strokeLinecap:"round",children:[e.jsx("animate",{attributeName:"y1",values:"25;10;25",dur:"1s",begin:"0.2s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"y2",values:"25;40;25",dur:"1s",begin:"0.2s",repeatCount:"indefinite"})]}),e.jsxs("line",{x1:"50",y1:"25",x2:"50",y2:"25",stroke:"#60A5FA",strokeWidth:"4",strokeLinecap:"round",children:[e.jsx("animate",{attributeName:"y1",values:"25;10;25",dur:"1s",begin:"0.4s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"y2",values:"25;40;25",dur:"1s",begin:"0.4s",repeatCount:"indefinite"})]}),e.jsxs("line",{x1:"70",y1:"25",x2:"70",y2:"25",stroke:"#60A5FA",strokeWidth:"4",strokeLinecap:"round",children:[e.jsx("animate",{attributeName:"y1",values:"25;10;25",dur:"1s",begin:"0.6000000000000001s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"y2",values:"25;40;25",dur:"1s",begin:"0.6000000000000001s",repeatCount:"indefinite"})]}),e.jsxs("line",{x1:"90",y1:"25",x2:"90",y2:"25",stroke:"#60A5FA",strokeWidth:"4",strokeLinecap:"round",children:[e.jsx("animate",{attributeName:"y1",values:"25;10;25",dur:"1s",begin:"0.8s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"y2",values:"25;40;25",dur:"1s",begin:"0.8s",repeatCount:"indefinite"})]})]})})}),!d&&!x&&r.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-3 gap-x-2 gap-y-6 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-5 lg:gap-x-4 xl:grid-cols-6",children:r.map((t=>e.jsxs("a",{href:`/phim/${t.slug}`,className:"group relative flex-shrink-0",children:[e.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-[4px]",children:[e.jsx("img",{src:t.poster_url,alt:t.title||t.ten_phim,className:"h-full w-full rounded-[4px] object-cover"}),e.jsx("div",{className:"absolute inset-0 rounded-[4px] bg-black/20 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),e.jsxs("div",{className:"absolute bottom-2 left-2 flex flex-col gap-2 font-semibold",children:[e.jsx("span",{className:"w-fit whitespace-nowrap rounded-[4px] bg-sky-300 px-2 py-0.5 text-[10px] text-black lg:py-1 lg:text-xs",children:Y(t.ngon_ngu)}),e.jsx("span",{className:"w-fit whitespace-nowrap rounded-[4px] bg-[linear-gradient(90deg,#e5330b_0%,#ff670b_51%,#d9a666_100%)] px-2 py-0.5 text-[10px] text-white lg:py-1 lg:text-xs",children:D(t.tinh_trang)})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-2",children:[e.jsx("h3",{className:"line-clamp-2 text-center text-xs font-normal text-white hover:text-sky-300 lg:text-sm",title:t.ten_phim,children:t.ten_phim}),e.jsx("p",{className:"line-clamp-2 text-center text-xs font-normal text-gray-400",children:t.ten_khac})]})]},t.id)))}),N>1&&e.jsxs("nav",{className:"mt-8 flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>L(w-1),className:"flex h-10 w-10 items-center justify-center rounded-[4px] bg-[#2f3346] text-sm text-gray-300 hover:bg-[#2f3346]/80 disabled:opacity-70","aria-label":"Trang trước",disabled:d||1===w,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",children:e.jsx("path",{fill:"currentColor",d:"m2 10l8 8l1.4-1.4L5.8 11H18V9H5.8l5.6-5.6L10 2z"})})}),e.jsxs("div",{className:"flex h-10 items-center space-x-2 rounded-[4px] bg-[#2f3346] px-4 py-1 text-sm text-gray-300",children:[e.jsx("span",{children:"Trang"}),e.jsx("input",{type:"number",value:m,onChange:e=>{let t=e.target.value;const a=parseInt(t,10);if(!isNaN(a)&&a>N)t=N.toString();else if(!t||isNaN(a))return void g(t);g(t)},onKeyDown:e=>{if("Enter"===e.key){const e=parseInt(m,10);let t;t=isNaN(e)||e<1?1:e>N?N:e,L(t)}},className:"w-10 appearance-none rounded-md border border-gray-500 bg-transparent py-1 text-center focus:outline-none",min:"1",max:N}),e.jsxs("span",{children:["/ ",N]})]}),e.jsx("button",{onClick:()=>L(w+1),className:"flex h-10 w-10 items-center justify-center rounded-[4px] bg-[#2f3346] text-sm text-gray-300 hover:bg-[#2f3346]/80 disabled:opacity-70","aria-label":"Trang sau",disabled:d||w===N,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",children:e.jsx("path",{fill:"currentColor",d:"M8.6 3.4L14.2 9H2v2h12.2l-5.6 5.6L10 18l8-8l-8-8z"})})})]})]})}export{Z as default};