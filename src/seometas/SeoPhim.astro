---
import { capitalizeWords, cleanhtml } from "../utils/movieUtils";
const { movie, slug } = Astro.props;

const SEO = {
  siteName: "Trạm Phim",

  siteUrl: Astro.url.origin,
  canonical: Astro.url.href,

  name: capitalizeWords(movie.ten_phim || ""),
  originName: movie.ten_khac || "",
  year: movie.nam_phat_hanh || "",
  description: cleanhtml(movie.mo_ta),

  poster: movie.poster_url,

  genres: Array.isArray(movie.the_loai)
    ? movie.the_loai.map(g => g.ten)
    : [],
};

const pageTitle = `Phim ${SEO.name} | ${SEO.originName} - ${SEO.siteName}`;
const metaDescription = (
  `Xem Phim ${SEO.name} ${SEO.year} Vietsub Thuyết minh mới nhất trên ${SEO.siteName} - ${SEO.description}`
).slice(0, 250).trim() + "…";

const fullSchema = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Movie",
      "@id": `${SEO.canonical}#movie`,
      name: SEO.name,
      description: SEO.description,
      image: SEO.poster,
      url: SEO.canonical,
      genre: SEO.genres,
    },

    {
      "@type": "BreadcrumbList",
      "@id": `${SEO.canonical}#breadcrumb`,
      itemListElement: [
        { "@type": "ListItem", position: 1, name: "Trang chủ", item: `${SEO.siteUrl}/` },
        { "@type": "ListItem", position: 2, name: "Phim", item: `${SEO.siteUrl}/phim` },
        { "@type": "ListItem", position: 3, name: SEO.name, item: SEO.canonical },
      ],
    },

    {
      "@type": "WebSite",
      "@id": `${SEO.siteUrl}#website`,
      url: SEO.siteUrl,
      name: SEO.siteName,
      potentialAction: {
        "@type": "SearchAction",
        target: `${SEO.siteUrl}/search?q={search_term_string}`,
        "query-input": "required name=search_term_string",
      },
    },

    {
      "@type": "Organization",
      "@id": `${SEO.siteUrl}#organization`,
      name: SEO.siteName,
      url: SEO.siteUrl,
      logo: {
        "@type": "ImageObject",
        url: `${SEO.siteUrl}/thumb_web.png`,
      },
    },
  ],
};
---

<title>{pageTitle}</title>
<meta name="description" content={metaDescription} />
<link rel="canonical" href={SEO.canonical} />

<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={metaDescription} />
<meta property="og:image" content={SEO.poster} />
<meta property="og:url" content={SEO.canonical} />
<meta property="og:type" content="video.movie" />
<meta property="og:site_name" content={SEO.siteName} />
<meta property="og:locale" content="vi_VN" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={metaDescription} />
<meta name="twitter:image" content={SEO.poster} />

<script type="application/ld+json" set:html={JSON.stringify(fullSchema)} />
