---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header/Header.jsx";
import Footer from "../components/Footer/index.jsx";
---

<Layout>
  <slot name="head">
    <title>Tải Ứng Dụng TrạmPhim - Xem Phim Mọi Lúc Mọi Nơi</title>
    <meta name="description" content="Tải ứng dụng TrạmPhim cho điện thoại Android và Android TV để xem phim mượt mà hơn." />
  </slot>

  <Header client:load />

  <main class="min-h-screen bg-[var(--color-bg-primary)] pt-20">
    <div class="container mx-auto px-4 py-12">
      <!-- Hero Section -->
      <div class="mb-12 text-center">
        <h1 class="mb-4 text-3xl font-bold text-white md:text-4xl lg:text-5xl">
          Tải Ứng Dụng <span class="bg-gradient-to-r from-sky-400 to-blue-500 bg-clip-text text-transparent">TrạmPhim</span>
        </h1>
        <p class="mx-auto max-w-2xl text-lg text-gray-400">
          Trải nghiệm xem phim mượt mà trên điện thoại Android và Android TV với ứng dụng chính thức của TrạmPhim.
        </p>
      </div>

      <!-- Download Cards -->
      <div class="mx-auto grid max-w-4xl gap-6 md:grid-cols-2">
        
        <!-- Mobile App Card -->
        <div class="rounded-2xl border border-white/10 bg-[var(--color-bg-card)] p-6 transition-transform hover:scale-[1.02]">
          <div class="mb-4 flex items-center gap-4">
            <div class="flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-sky-500 to-blue-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="14" height="20" x="5" y="2" rx="2" ry="2"/>
                <path d="M12 18h.01"/>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-white">Android Mobile</h2>
              <p class="text-sm text-gray-400">Cho điện thoại & máy tính bảng</p>
            </div>
          </div>
          
          <ul class="mb-6 space-y-2 text-gray-300">
            <li class="flex items-center gap-2">
              <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              Giao diện tối ưu cho màn hình nhỏ
            </li>
            <li class="flex items-center gap-2">
              <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              Xem phim mượt mà, không giật lag
            </li>
            <li class="flex items-center gap-2">
              <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              Đồng bộ lịch sử xem phim
            </li>
          </ul>

          <a 
            id="mobile-download-btn"
            href="#"
            class="flex w-full items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-sky-500 to-blue-600 px-6 py-3 font-semibold text-white transition-all hover:from-sky-600 hover:to-blue-700 disabled:opacity-50"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
            <span>Tải APK cho Mobile</span>
          </a>
          <p id="mobile-version" class="mt-2 text-center text-xs text-gray-500">Đang tải thông tin...</p>
        </div>

        <!-- TV App Card -->
        <div class="rounded-2xl border border-white/10 bg-[var(--color-bg-card)] p-6 transition-transform hover:scale-[1.02]">
          <div class="mb-4 flex items-center gap-4">
            <div class="flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-purple-500 to-pink-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="15" x="2" y="3" rx="2"/>
                <polyline points="8 21 12 17 16 21"/>
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-white">Android TV</h2>
              <p class="text-sm text-gray-400">Cho TV thông minh & TV Box</p>
            </div>
          </div>
          
          <ul class="mb-6 space-y-2 text-gray-300">
            <li class="flex items-center gap-2">
              <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              Giao diện tối ưu cho màn hình lớn
            </li>
            <li class="flex items-center gap-2">
              <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              Điều khiển bằng remote TV dễ dàng
            </li>
            <li class="flex items-center gap-2">
              <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              Chất lượng Full HD
            </li>
          </ul>

          <a 
            id="tv-download-btn"
            href="#"
            class="flex w-full items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-purple-500 to-pink-600 px-6 py-3 font-semibold text-white transition-all hover:from-purple-600 hover:to-pink-700 disabled:opacity-50"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
            <span>Tải APK cho TV</span>
          </a>
          <p id="tv-version" class="mt-2 text-center text-xs text-gray-500">Đang tải thông tin...</p>
        </div>
      </div>

      <!-- Installation Guide -->
      <div class="mx-auto mt-12 max-w-4xl">
        <h3 class="mb-6 text-center text-2xl font-bold text-white">Hướng Dẫn Cài Đặt</h3>
        
        <div class="grid gap-6 md:grid-cols-3">
          <div class="rounded-xl border border-white/10 bg-[var(--color-bg-card)] p-5 text-center">
            <div class="mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-sky-500/20 text-sky-400">
              <span class="text-xl font-bold">1</span>
            </div>
            <h4 class="mb-2 font-semibold text-white">Tải file APK</h4>
            <p class="text-sm text-gray-400">Nhấn nút tải ở trên để tải file APK về thiết bị của bạn.</p>
          </div>
          
          <div class="rounded-xl border border-white/10 bg-[var(--color-bg-card)] p-5 text-center">
            <div class="mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-sky-500/20 text-sky-400">
              <span class="text-xl font-bold">2</span>
            </div>
            <h4 class="mb-2 font-semibold text-white">Cho phép cài đặt</h4>
            <p class="text-sm text-gray-400">Vào Cài đặt → Bảo mật → Bật "Nguồn không xác định".</p>
          </div>
          
          <div class="rounded-xl border border-white/10 bg-[var(--color-bg-card)] p-5 text-center">
            <div class="mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-sky-500/20 text-sky-400">
              <span class="text-xl font-bold">3</span>
            </div>
            <h4 class="mb-2 font-semibold text-white">Cài đặt & Xem phim</h4>
            <p class="text-sm text-gray-400">Mở file APK đã tải, nhấn Cài đặt và bắt đầu xem phim!</p>
          </div>
        </div>
      </div>

      <!-- Note -->
      <div class="mx-auto mt-8 max-w-2xl rounded-xl border border-yellow-500/30 bg-yellow-500/10 p-4 text-center">
        <p class="text-sm text-yellow-200">
          <strong>Lưu ý:</strong> Ứng dụng chỉ hoạt động trên Android. Nếu bạn dùng iOS, vui lòng truy cập website qua trình duyệt Safari.
        </p>
      </div>
    </div>
  </main>

  <Footer client:load />
</Layout>

<script>
  const API_BASE = import.meta.env.PUBLIC_API_URL || 'https://api.tramphim.net';
  
  async function fetchAppVersions() {
    try {
      // Fetch mobile version
      const mobileRes = await fetch(`${API_BASE}/api/app-version/latest?platform=mobile`);
      if (mobileRes.ok) {
        const data = await mobileRes.json();
        const mobileBtn = document.getElementById('mobile-download-btn');
        const mobileVersion = document.getElementById('mobile-version');
        if (data.download_url) {
          mobileBtn.href = data.download_url;
          mobileVersion.textContent = `Phiên bản ${data.version || '1.0.0'} • ${formatFileSize(data.file_size)}`;
        } else {
          mobileVersion.textContent = 'Chưa có bản cài đặt';
        }
      } else {
        document.getElementById('mobile-version').textContent = 'Chưa có bản cài đặt';
      }
    } catch (e) {
      document.getElementById('mobile-version').textContent = 'Chưa có bản cài đặt';
    }

    try {
      // Fetch TV version
      const tvRes = await fetch(`${API_BASE}/api/app-version/latest?platform=tv`);
      if (tvRes.ok) {
        const data = await tvRes.json();
        const tvBtn = document.getElementById('tv-download-btn');
        const tvVersion = document.getElementById('tv-version');
        if (data.download_url) {
          tvBtn.href = data.download_url;
          tvVersion.textContent = `Phiên bản ${data.version || '1.0.0'} • ${formatFileSize(data.file_size)}`;
        } else {
          tvVersion.textContent = 'Chưa có bản cài đặt';
        }
      } else {
        document.getElementById('tv-version').textContent = 'Chưa có bản cài đặt';
      }
    } catch (e) {
      document.getElementById('tv-version').textContent = 'Chưa có bản cài đặt';
    }
  }

  function formatFileSize(bytes) {
    if (!bytes) return '';
    const mb = bytes / (1024 * 1024);
    return `${mb.toFixed(1)} MB`;
  }

  fetchAppVersions();
</script>
