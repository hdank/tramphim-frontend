---
export const prerender = false;
export const revalidate = 1800; 
import BaseLayout from "../layouts/Layout.astro";
import { getHomePageData } from "../utils/getMovieHome.js";
import Hero from "../components/Hero/Hero";
import Header from "../components/Header/Header";
import Footer from "../components/Footer/index";
import MovieCardColumn from "../components/MovieCardHome/CardColumn.jsx";
import MovieCardTop from "../components/MovieCardHome/CardColumnTop.jsx";
import AnimeCardHorizontal from "../components/MovieCardHome/CardAnimeHorizontal.jsx";
import MovieCardCategory from "../components/MovieCardHome/CardPhimCategory.jsx";
import SeoHome from "../seometas/SeoHome.astro";
import ChuDe from "../components/ToPics/ToPics.jsx";
const homePageData = await getHomePageData();
const {
  movieheros,
  moviehots,
  movieupdates,
  themes,
  moviechieuraps,
  moviephimbos,
  moviephimles,
  movieanimes,
} = homePageData;
const loading = false;
const error = null;

// Get first hero movie's banner for preloading (critical for LCP)
const heroImageUrl = moviehots?.[0]?.banner_url || moviehots?.[0]?.poster_url;
// Get first TOP 10 poster for preloading
const top10PosterUrl = moviehots?.[0]?.poster_url;
---

<BaseLayout>
  {/* Preload critical images for better LCP */}
  <Fragment slot="preload">
    {heroImageUrl && (
      <link rel="preload" as="image" href={heroImageUrl} fetchpriority="high" />
    )}
    {top10PosterUrl && top10PosterUrl !== heroImageUrl && (
      <link rel="preload" as="image" href={top10PosterUrl} />
    )}
  </Fragment>

  <Fragment slot="head">
    <SeoHome />
  </Fragment>

  <div id="splash-screen"></div>
  <Header client:load />

  <div class="main-container">
    <h1 class="sr-only">
      Trạm Phim - Phim hay tại Trạm
    </h1>
    <div class="main-content-wrapper">
      <main id="main-content" class="home-main">
        <!-- Hero Section -->
        <section class="hero-wrapper">
          <Hero client:load movies={moviehots} loading={loading} />
        </section>
        
        <!-- Movie Sections -->
        <div class="card-column-gap">
          <!-- Top 10 Section with special styling -->
          <section class="section-wrapper animate-section top-section">
            <MovieCardTop
              client:idle
              movies={moviehots}
              title="TOP 10 Hôm Nay"
              loading={loading}
              error={error}
            />
          </section>
          
          <!-- Anime Section - Japanese Animation -->
          <section class="section-wrapper animate-section anime-section">
            <AnimeCardHorizontal
              client:idle
              title="Anime"
              movies={movieanimes}
              loading={loading}
              error={error}
            />
          </section>
          
          <!-- New Episodes -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:idle
              title="Phim Có Tập Mới"
              movies={movieupdates}
              loading={loading}
              error={error}
            />
          </section>
          
          <!-- Cinema Movies -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:idle
              title="Phim Chiếu Rạp Hot Nhất 2025"
              movies={moviechieuraps}
              loading={loading}
              error={error}
            />
          </section>
          
          <!-- Single Movies -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:visible
              title="Phim Lẻ"
              movies={moviephimles}
              loading={loading}
              error={error}
            />
          </section>
          
          <!-- Series -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:visible
              title="Phim Bộ"
              movies={moviephimbos}
              loading={loading}
              error={error}
            />
          </section>
        </div>
      </main>
    </div>
  </div>
  <footer>
    <Footer client:only="react" />
  </footer>
</BaseLayout>

<style>
  .home-main {
    @apply space-y-6 lg:space-y-10;
  }
  
  .hero-wrapper {
    @apply relative;
  }
  
  .section-wrapper {
    @apply relative;
  }
  
  .top-section {
    @apply relative;
  }
  
  .top-section::before {
    content: '';
    @apply absolute -inset-4 rounded-2xl opacity-30 -z-10;
    background: radial-gradient(ellipse at center, rgba(56, 189, 248, 0.1) 0%, transparent 70%);
  }
  
  /* Anime Section Special Styling */
  .anime-section {
    @apply relative;
  }
  
  .anime-section::before {
    content: '';
    @apply absolute -inset-4 rounded-2xl opacity-25 -z-10;
    background: radial-gradient(ellipse at center, rgba(255, 107, 157, 0.15) 0%, transparent 70%);
  }
  
  .animate-section {
    @apply opacity-0;
    animation: fadeInSection 0.5s ease-out forwards;
  }
  
  .animate-section:nth-child(1) { animation-delay: 0.1s; }
  .animate-section:nth-child(2) { animation-delay: 0.15s; }
  .animate-section:nth-child(3) { animation-delay: 0.2s; }
  .animate-section:nth-child(4) { animation-delay: 0.25s; }
  .animate-section:nth-child(5) { animation-delay: 0.3s; }
  .animate-section:nth-child(6) { animation-delay: 0.35s; }
  .animate-section:nth-child(7) { animation-delay: 0.4s; }
  
  @keyframes fadeInSection {
    to {
      opacity: 1;
    }
  }
</style>

<script>
  // Enhanced scroll-triggered animations
  document.addEventListener("DOMContentLoaded", () => {
    const sections = document.querySelectorAll(".animate-section");

    const observerOptions = {
      root: null,
      rootMargin: "0px 0px -50px 0px",
      threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.style.animationPlayState = 'running';
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    sections.forEach((section) => {
      section.style.animationPlayState = 'paused';
      observer.observe(section);
    });
    
    // Smooth scroll behavior
    document.documentElement.style.scrollBehavior = 'smooth';
  });
</script>
