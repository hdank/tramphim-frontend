---
export const prerender = false;
export const revalidate = 1800; 
import BaseLayout from "../layouts/Layout.astro";
import { getHomePageData } from "../utils/getMovieHome.js";
import Hero from "../components/Hero/Hero";
import Header from "../components/Header/Header";
import Footer from "../components/Footer/index";
import MovieCardColumn from "../components/MovieCardHome/CardColumn.jsx";
import MovieCardTop from "../components/MovieCardHome/CardColumnTop.jsx";
import AnimeCardHorizontal from "../components/MovieCardHome/CardAnimeHorizontal.jsx";
import MovieCardCategory from "../components/MovieCardHome/CardPhimCategory.jsx";
import MinimalHeroMovieCard from "../components/MovieCardHome/MinimalHeroMovieCard.jsx"
import SeoHome from "../seometas/SeoHome.astro";
import ChuDe from "../components/ToPics/ToPics.jsx";
const homePageData = await getHomePageData();
const {
  movieheros,
  moviehots,
  movieupdates,
  themes,
  moviechieuraps,
  moviephimbos,
  moviephimles,
  movieanimes,
  movie2026,
  latestAnimes,
  chineseAnime,
  dramaMovies,
  horrorMovies,
  koreaMovies,
  familyMovies,
} = homePageData;
const loading = false;
const error = null;

// Get first hero movie's banner for preloading (critical for LCP)
const heroImageUrl = moviehots?.[0]?.banner_url || moviehots?.[0]?.poster_url;
// Get first TOP 10 poster for preloading
const top10PosterUrl = moviehots?.[0]?.poster_url;
---

<BaseLayout>
  {/* Preload critical images for better LCP */}
  <Fragment slot="preload">
    {heroImageUrl && (
      <link rel="preload" as="image" href={heroImageUrl} fetchpriority="high" />
    )}
    {top10PosterUrl && top10PosterUrl !== heroImageUrl && (
      <link rel="preload" as="image" href={top10PosterUrl} />
    )}
  </Fragment>

  <Fragment slot="head">
    <SeoHome />
  </Fragment>

  <div id="splash-screen"></div>
  <Header client:load />

  <div class="main-container">
    <h1 class="sr-only">
      Trạm Phim - Phim hay tại Trạm
    </h1>
    <div class="main-content-wrapper">
      <main id="main-content" class="home-main">
        <!-- Hero Section -->
        <section class="hero-wrapper">
          <Hero client:load movies={moviehots} loading={loading} />
        </section>
        
        <!-- Movie Sections -->
        <div class="card-column-gap">
          <!-- Top 10 Section with special styling -->
          <section class="section-wrapper animate-section top-section">
            <MovieCardTop
              client:idle
              movies={moviehots}
              title="TOP 10 Hôm Nay"
              loading={loading}
              error={error}
            />
          </section>

          <!-- Phim Mới 2026 Section -->
          <section class="section-wrapper animate-section phim-moi-2026-section">
            <AnimeCardHorizontal
              client:idle
              title="Phim Mới 2026"
              movies={movie2026}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Anime Section - Japanese Animation -->
          <section class="section-wrapper animate-section anime-section">
            <AnimeCardHorizontal
              client:idle
              title="Anime"
              movies={movieanimes}
              loading={loading}
              error={error}
            />
          </section>
          
          <!-- New Episodes -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:idle
              title="Phim Có Tập Mới"
              movies={movieupdates}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Chinese Anime Section -->
          <section class="section-wrapper animate-section chinese-anime-section">
            <AnimeCardHorizontal
              client:idle
              title="Nữ Nhân Chỉ Ảnh Hưởng Tốc Độ Chạy Bo Của Ta"
              movies={chineseAnime}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Cinema Movies -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:idle
              title="Phim Chiếu Rạp Hot Nhất 2025"
              movies={moviechieuraps}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Family Movies Section -->
          <section class="section-wrapper animate-section">
            <div class="flex items-center gap-3 mb-4">
              <span class="inline-block w-8 h-1 rounded-full bg-cyan-400" />
              <h3 class="header-title">Đường Về Nhà Là Vào Tim Ta</h3>
            </div>

            <MinimalHeroMovieCard
              client:idle
              movies={familyMovies}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Latest Anime Section -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:idle
              title="Anime Mới Nhất"
              movies={latestAnimes}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Drama Movies Section -->
          <section class="section-wrapper animate-section drama-movies-section">
            <AnimeCardHorizontal
              client:idle
              title="Hít Chút Drama Cho Bổ Phổi Nè Bé Iu"
              movies={dramaMovies}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Horror Movies Section -->
          <section class="section-wrapper animate-section drama-movies-section">
            <MovieCardColumn
              client:idle
              title="Bạn Sợ À ?"
              movies={horrorMovies}
              loading={loading}
              error={error}
            />
          </section>

          <!-- Top Korea Movies -->
          <section class="section-wrapper animate-section top-section">
            <MovieCardTop
              client:idle
              movies={koreaMovies}
              title="TOP Phim Hàn Xẻng Để Cày Nè"
              loading={loading}
              error={error}
            />
          </section>
          <!-- Single Movies -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:visible
              title="Phim Lẻ"
              movies={moviephimles}
              loading={loading}
              error={error}
            />
          </section>
          
          <!-- Series -->
          <section class="section-wrapper animate-section">
            <MovieCardColumn
              client:visible
              title="Phim Bộ"
              movies={moviephimbos}
              loading={loading}
              error={error}
            />
          </section>
        </div>
      </main>
    </div>
  </div>
  <footer>
    <Footer client:only="react" />
  </footer>
</BaseLayout>

<style>
  .home-main {
    @apply space-y-6 lg:space-y-10;
  }
  
  .hero-wrapper {
    @apply relative;
    /* default smaller height on mobile / tablet; overridden on desktop */
    min-height: 60vh;
  }

  /* Desktop: make hero full viewport height (subtract header height) */
  @media (min-width: 1024px) {
    .hero-wrapper {
      min-height: calc(100vh - 80px);
    }

    /* Ensure hero section fills the available area and content is centered vertically */
    .hero-featured-section {
      min-height: calc(100vh - 80px);
      display: flex;
      align-items: center;
    }

    /* Make sure background covers the full hero height */
    .hero-featured-bg {
      min-height: calc(100vh - 80px);
      height: 100%;
    }
  }
  
  .section-wrapper {
    @apply relative;
  }
  
  .top-section {
    @apply relative;
  }
  
  .top-section::before {
    content: '';
    @apply absolute -inset-4 rounded-2xl opacity-30 -z-10;
    background: radial-gradient(ellipse at center, rgba(56, 189, 248, 0.1) 0%, transparent 70%);
  }
  
  /* Anime Section Special Styling */
  .anime-section {
    @apply relative;
  }

  .anime-section::before {
    content: '';
    @apply absolute -inset-4 rounded-2xl opacity-25 -z-10;
    background: radial-gradient(ellipse at center, rgba(255, 107, 157, 0.15) 0%, transparent 70%);
  }

  /* Phim Mới 2026 Section Special Styling */
  .phim-moi-2026-section {
    @apply relative;
  }

  .phim-moi-2026-section::before {
    content: '';
    @apply absolute -inset-4 rounded-2xl opacity-25 -z-10;
    background: radial-gradient(ellipse at center, rgba(34, 197, 94, 0.15) 0%, transparent 70%);
  }

  /* Chinese Anime Section Special Styling */
  .chinese-anime-section {
    @apply relative;
  }

  .chinese-anime-section::before {
    content: '';
    @apply absolute -inset-4 rounded-2xl opacity-25 -z-10;
    background: radial-gradient(ellipse at center, rgba(249, 115, 22, 0.15) 0%, transparent 70%);
  }

  /* Drama Movies Section Special Styling */
  .drama-movies-section {
    @apply relative;
  }

  .drama-movies-section::before {
    content: '';
    @apply absolute -inset-4 rounded-2xl opacity-25 -z-10;
    background: radial-gradient(ellipse at center, rgba(255, 107, 157, 0.15) 0%, transparent 70%);
  }
  
  .animate-section {
    @apply opacity-0;
    animation: fadeInSection 0.5s ease-out forwards;
  }
  
  .animate-section:nth-child(1) { animation-delay: 0.1s; }
  .animate-section:nth-child(2) { animation-delay: 0.15s; }
  .animate-section:nth-child(3) { animation-delay: 0.2s; }
  .animate-section:nth-child(4) { animation-delay: 0.25s; }
  .animate-section:nth-child(5) { animation-delay: 0.3s; }
  .animate-section:nth-child(6) { animation-delay: 0.35s; }
  .animate-section:nth-child(7) { animation-delay: 0.4s; }
  .animate-section:nth-child(8) { animation-delay: 0.45s; }
  .animate-section:nth-child(9) { animation-delay: 0.5s; }
  .animate-section:nth-child(10) { animation-delay: 0.55s; }
  .animate-section:nth-child(11) { animation-delay: 0.6s; }
  
  @keyframes fadeInSection {
    to {
      opacity: 1;
    }
  }
</style>

<script>
  // Enhanced scroll-triggered animations
  document.addEventListener("DOMContentLoaded", () => {
    const sections = document.querySelectorAll(".animate-section");

    const observerOptions = {
      root: null,
      rootMargin: "0px 0px -50px 0px",
      threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.style.animationPlayState = 'running';
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    sections.forEach((section) => {
      section.style.animationPlayState = 'paused';
      observer.observe(section);
    });
    
    // Smooth scroll behavior
    document.documentElement.style.scrollBehavior = 'smooth';
  });
</script>
